<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>同义替换训练器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .word-box {
            margin: 20px 0;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 8px;
        }
        .options-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .option-item {
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .option-item.selected {
            border-color: #2196F3;
            background: #e3f2fd;
        }
        .correct { background: #c8e6c9 !important; }
        .wrong { background: #ffcdd2 !important; }
        button {
            padding: 12px 24px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
        }
        .current-words {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .word-card {
            padding: 15px;
            border: 2px solid #2196F3;
            border-radius: 8px;
            flex: 1;
            text-align: center;
        }
        .definition-btn {
            background: #4CAF50;
            padding: 6px 12px;
            font-size: 0.9em;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        .marker-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }
        .marker-btn {
            background: #ff9800;
            padding: 8px 16px;
        }
        .marker-btn.active {
            background: #f57c00;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #ff9800;
        }
    </style>
</head>
<body>
    <div class="current-words" id="currentWords"></div>
    <div class="marker-buttons">
        <button class="marker-btn" onclick="selectMarker(1)">标记单词1</button>
        <button class="marker-btn" onclick="selectMarker(2)">标记单词2</button>
        <button class="marker-btn" onclick="selectMarker(3)">标记单词3</button>
    </div>
    <div class="options-grid" id="optionsGrid"></div>
    
    <div class="button-group">
        <button onclick="checkAnswers()" id="submitBtn">提交答案</button>
        <button onclick="prepareBatch()" id="nextBtn" style="display: none;">下一组</button>
    </div>

    <script>
        // 示例数据 - 需要替换为完整数据
        const wordData = {
            "resemble": {
                "词义": "像，与……相似",
                "同义替换": ["like", "look like", "be similar to"]
            },
            // 其他单词数据...
        };

        let candidatePool = [];
        let currentBatch = [];
        let allSynonyms = [];
        let userAnswers = {};
        let isAnswerChecked = false; // 新增状态标记
        let currentMarker = 0; // 0表示未选择标记器
        let currentPosition = 0;

        // 初始化候选池
        function initCandidatePool() {
            const words = Object.keys(wordData);
            currentPosition = Math.floor(Math.random() * words.length);
            candidatePool = [];
            
            // 初始填充10个单词
            for(let i=0; i<10; i++) {
                const index = (currentPosition + i) % words.length;
                candidatePool.push(words[index]);
            }
            currentPosition = (currentPosition + 10) % words.length;
        }

        // 补充候选池
        function refillCandidatePool() {
            const words = Object.keys(wordData);
            // 每次补充3个新单词
            for(let i=0; i<3; i++) {
                const index = currentPosition % words.length;
                candidatePool.push(words[index]);
                currentPosition = (currentPosition + 1) % words.length;
            }
        }

        // 准备训练批次
        function prepareBatch() {
            // 随机选取3个不同单词
            const selectedIndexes = new Set();
            while(selectedIndexes.size < 3) {
                const randomIndex = Math.floor(Math.random() * candidatePool.length);
                selectedIndexes.add(randomIndex);
            }
            
            // 按降序删除避免索引错位
            currentBatch = Array.from(selectedIndexes)
                .sort((a,b) => b - a)
                .map(i => candidatePool.splice(i, 1)[0]);
            
            // 补充新单词
            refillCandidatePool();
            
            // 收集正确选项
            const correctOptions = currentBatch.flatMap(word => 
                wordData[word].同义替换
            );
            
            // 收集其他选项
            const otherOptions = Object.entries(wordData)
                .filter(([word]) => !currentBatch.includes(word))
                .flatMap(([_, data]) => data.同义替换);
            
            // 合并选项并打乱顺序
            allSynonyms = correctOptions.concat(
                otherOptions.sort(() => Math.random() - 0.5)
                    .slice(0, 30 - correctOptions.length)
            ).sort(() => Math.random() - 0.5);

            // 重置界面状态
            isAnswerChecked = false;
            currentMarker = 0;
            userAnswers = {};
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            updateMarkerButtons();
            renderInterface();
        }

        // 更新标记按钮状态
        function updateMarkerButtons() {
            document.querySelectorAll('.marker-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === `标记单词${currentMarker}`);
            });
        }

        // 选择标记器
        function selectMarker(markerNumber) {
            currentMarker = currentMarker === markerNumber ? 0 : markerNumber;
            updateMarkerButtons();
        }

        // 渲染界面
        function renderInterface() {
            // 显示当前单词
            const wordsContainer = document.getElementById('currentWords');
            wordsContainer.innerHTML = currentBatch.map((word, index) => `
                <div class="word-card">
                    <h3>单词 ${index+1}</h3>
                    <div>${word}</div>
                    <button class="definition-btn" onclick="toggleDefinition(${index})">显示词义</button>
                    <small style="display: none;">${wordData[word].词义}</small>
                </div>
            `).join('');

            // 生成选项
            const optionsContainer = document.getElementById('optionsGrid');
            optionsContainer.innerHTML = allSynonyms.map((syn, index) => {
                const mark = userAnswers[index] || '';
                return `<div class="option-item ${mark ? 'selected' : ''}" 
                          data-index="${index}"
                          onclick="handleOptionClick(${index})">
                    ${syn}
                    ${mark ? `<div>${mark}</div>` : ''}
                </div>`;
            }).join('');
        }

        // 处理选项点击
        function handleOptionClick(index) {
            if(isAnswerChecked || !currentMarker) return;
            
            if(userAnswers[index] === currentMarker) {
                delete userAnswers[index];
            } else {
                userAnswers[index] = currentMarker;
            }
            renderInterface();
        }

        // 切换词义显示
        function toggleDefinition(index) {
            const wordCard = document.querySelectorAll('.word-card')[index];
            const definition = wordCard.querySelector('small');
            const button = wordCard.querySelector('button');
            definition.style.display = definition.style.display === 'none' ? 'block' : 'none';
            button.textContent = definition.style.display === 'none' ? '显示词义' : '隐藏词义';
        }

        // 检查答案
        function checkAnswers() {
            isAnswerChecked = true; // 设置已检查状态
            currentMarker = 0;
            updateMarkerButtons();
            
            // 获取正确答案映射
            const correctMap = currentBatch.reduce((acc, word, wordIndex) => {
                wordData[word].同义替换.forEach(syn => {
                    const synIndex = allSynonyms.indexOf(syn);
                    if(synIndex !== -1) acc[synIndex] = wordIndex+1;
                });
                return acc;
            }, {});

            // 验证答案
            const options = document.querySelectorAll('.option-item');
            options.forEach(option => {
                const index = parseInt(option.dataset.index);
                const isCorrect = correctMap[index] === userAnswers[index];
                const shouldHave = correctMap[index] || '无';
                
                if(!isCorrect) {
                    option.classList.add('wrong');
                    option.innerHTML += `<div>正确答案: ${shouldHave}</div>`;
                }
                if(correctMap[index]) {
                    option.classList.add('correct');
                }
            });

            // 切换按钮状态
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        // 初始化启动
        initCandidatePool();
        prepareBatch();
    </script>
</body>
</html>